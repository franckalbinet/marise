<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Parse MARIS NetCDF files metadata, index and query them using Ragatouille.">

<title>Metadata Indexing &amp; Retrieval – marise</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Metadata Indexing &amp; Retrieval – marise">
<meta property="og:description" content="Parse MARIS NetCDF files metadata, index and query them using Ragatouille.">
<meta property="og:site_name" content="marise">
<meta name="twitter:title" content="Metadata Indexing &amp; Retrieval – marise">
<meta name="twitter:description" content="Parse MARIS NetCDF files metadata, index and query them using Ragatouille.">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">marise</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./metadata.html">Metadata Indexing &amp; Retrieval</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">marise</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./metadata.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Metadata Indexing &amp; Retrieval</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#read_metadata" id="toc-read_metadata" class="nav-link active" data-scroll-target="#read_metadata">read_metadata</a></li>
  <li><a href="#read_metadata_from_directory" id="toc-read_metadata_from_directory" class="nav-link" data-scroll-target="#read_metadata_from_directory">read_metadata_from_directory</a></li>
  <li><a href="#dict_to_string" id="toc-dict_to_string" class="nav-link" data-scroll-target="#dict_to_string">dict_to_string</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/franckalbinet/marise/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="metadata.html.md"><i class="bi bi-file-code"></i>CommonMark</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Metadata Indexing &amp; Retrieval</h1>
</div>

<div>
  <div class="description">
    Parse MARIS NetCDF files metadata, index and query them using Ragatouille.
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<hr>
<p><a href="https://github.com/franckalbinet/marise/blob/main/marise/metadata.py#L19" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="read_metadata" class="level3">
<h3 class="anchored" data-anchor-id="read_metadata">read_metadata</h3>
<blockquote class="blockquote">
<pre><code> read_metadata (fname)</code></pre>
</blockquote>
<p><em>Read a netcdf metadata file using netcdf4 package</em></p>
<div id="cell-3" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> netCDF4 <span class="im">as</span> nc</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastcore.<span class="bu">all</span> <span class="im">import</span> <span class="op">*</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ragatouille <span class="im">import</span> RAGPretrainedModel</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-4" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_metadata(fname):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Read a netcdf metadata file using netcdf4 package"</span>    </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> nc.Dataset(fname, <span class="st">'r'</span>) <span class="im">as</span> dataset:</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>            global_attrs <span class="op">=</span> {attr: dataset.getncattr(attr) <span class="cf">for</span> attr <span class="kw">in</span> dataset.ncattrs()}</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>            variables <span class="op">=</span> {}</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> var_name, var <span class="kw">in</span> dataset.variables.items():</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                variables[var_name] <span class="op">=</span> {</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'dimensions'</span>: var.dimensions,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'attributes'</span>: {attr: var.getncattr(attr) <span class="cf">for</span> attr <span class="kw">in</span> var.ncattrs()},</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'dtype'</span>: var.dtype,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'shape'</span>: var.shape</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>            metadata <span class="op">=</span> {</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>                <span class="st">'global_attributes'</span>: global_attrs,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 'variables': variables</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> metadata</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error reading NetCDF file: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-5" class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>fname <span class="op">=</span> <span class="st">'../_data/netcdf/2-Crusius-and-Anderson-1991.nc'</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>metadata <span class="op">=</span> read_metadata(fname)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'List of global metadata attributes:'</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(SEPARATOR)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>attributes <span class="op">=</span> <span class="bu">list</span>(metadata[<span class="st">'global_attributes'</span>].keys())</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(attributes), <span class="dv">4</span>): <span class="bu">print</span>(<span class="st">', '</span>.join(attributes[i:i<span class="op">+</span><span class="dv">4</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of global metadata attributes:
--------------------------------------------------------------------------------
id, title, summary, keywords
keywords_vocabulary, keywords_vocabulary_url, record, featureType
cdm_data_type, Conventions, publisher_name, publisher_email
publisher_url, publisher_institution, creator_name, institution
metadata_link, creator_email, creator_url, references
license, comment, geospatial_lat_min, geospatial_lon_min
geospatial_lat_max, geospatial_lon_max, geospatial_vertical_min, geospatial_vertical_max
geospatial_bounds, geospatial_bounds_crs, time_coverage_start, time_coverage_end
local_time_zone, date_created, date_modified, publisher_postprocess_logs</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/franckalbinet/marise/blob/main/marise/metadata.py#L44" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="read_metadata_from_directory" class="level3">
<h3 class="anchored" data-anchor-id="read_metadata_from_directory">read_metadata_from_directory</h3>
<blockquote class="blockquote">
<pre><code> read_metadata_from_directory (src_dir:str, recursive:bool=False)</code></pre>
</blockquote>
<p><em>Read metadata from all NetCDF files in the given directory.</em></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>src_dir</td>
<td>str</td>
<td></td>
<td>Directory containing NetCDF files”,</td>
</tr>
<tr class="even">
<td>recursive</td>
<td>bool</td>
<td>False</td>
<td>Search recursively in subdirectories</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>list</strong></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<div id="cell-7" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_metadata_from_directory(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    src_dir:<span class="bu">str</span>, <span class="co"># Directory containing NetCDF files",</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    recursive:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span> <span class="co"># Search recursively in subdirectories</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="bu">list</span>:</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Read metadata from all NetCDF files in the given directory."</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    src_dir <span class="op">=</span> Path(src_dir)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    pattern <span class="op">=</span> <span class="st">'**/*.nc'</span> <span class="cf">if</span> recursive <span class="cf">else</span> <span class="st">'*.nc'</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [{<span class="st">'fname'</span>: f.name, <span class="st">'value'</span>: read_metadata(f)}  <span class="cf">for</span> f <span class="kw">in</span> src_dir.glob(pattern)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-8" class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>src_dir <span class="op">=</span> <span class="st">'../_data/netcdf'</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>metadata_list <span class="op">=</span> read_metadata_from_directory(src_dir)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Number of metadata MARIS NetCDF files: </span><span class="sc">{</span><span class="bu">len</span>(metadata_list)<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Example metadata item name (MARIS NetCDF file name): </span><span class="sc">{</span>metadata_list[<span class="dv">0</span>][<span class="st">"fname"</span>]<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of metadata MARIS NetCDF files: 462
Example metadata item name (MARIS NetCDF file name): 484-Saito-et-al-2003.nc</code></pre>
</div>
</div>
<div id="cell-9" class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>RAG <span class="op">=</span> RAGPretrainedModel.from_pretrained(<span class="st">"colbert-ir/colbertv2.0"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[Sep 16, 15:12:50] Loading segmented_maxsim_cpp extension (set COLBERT_LOAD_TORCH_EXTENSION_VERBOSE=True for more info)...</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/franckalbinet/marise/blob/main/marise/metadata.py#L54" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="dict_to_string" class="level3">
<h3 class="anchored" data-anchor-id="dict_to_string">dict_to_string</h3>
<blockquote class="blockquote">
<pre><code> dict_to_string (d, indent=0)</code></pre>
</blockquote>
<p><em>Convert a dictionary to a formatted string.</em></p>
<div id="cell-11" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dict_to_string(d, indent<span class="op">=</span><span class="dv">0</span>):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Convert a dictionary to a formatted string."""</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> []</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> key, value <span class="kw">in</span> d.items():</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>        result.append(<span class="st">' '</span> <span class="op">*</span> indent <span class="op">+</span> <span class="bu">str</span>(key) <span class="op">+</span> <span class="st">': '</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(value, <span class="bu">dict</span>):</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>            result.append(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span> <span class="op">+</span> dict_to_string(value, indent <span class="op">+</span> <span class="dv">2</span>))</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>            result.append(<span class="bu">str</span>(value) <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">''</span>.join(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Usage example:</p>
<div id="cell-13" class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>metadata_string <span class="op">=</span> dict_to_string([m[<span class="st">'value'</span>] <span class="cf">for</span> m <span class="kw">in</span> metadata_list][<span class="dv">0</span>][<span class="st">'global_attributes'</span>])<span class="op">;</span> metadata_string</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>'id: \ntitle: 210Pb and 210Po levels in sediments, water, and bioindicators in the Cananeia-Iguape estuary - Sao Paulo - Brazil\nsummary: The purpose of this work was to determine levels of 210Pb and 210Po in seawater, sediment cores, fish and seafood as well as to estimate the concentration factors and the bioindicators for 210Pb and 210Po in marine organisms collected in the estuary. 210Pb levels in seawater varied from 2.1 to 6.2 mBq.L−1 and for 210Po ranged from 1.6 to 4.1 mBq.L−1. 210Pb concentration factors in fish varied from 0.5×102 to 0.8×103, in crustaceans from 0.5×103 to 0.2×104 and in shellfish from 0.2×104 to 0.3×104. 210Po concentration factors in fish varied from 0.9×102 to 0.5×104, in crustaceans from 0.5×104 to 0.2×105 and in shellfish from 0.3×105 to 0.9×105. The results obtained to the concentration factors indicated that shellfish and crustaceans are good bioindicators for the radionuclides studies. Some species of fish also accumulated significantly quantities of these radionuclides.\nkeywords: oceanography, Earth Science &gt; Oceans &gt; Ocean Chemistry&gt; Radionuclides, Earth Science &gt; Human Dimensions &gt; Environmental Impacts &gt; Nuclear Radiation Exposure, Earth Science &gt; Oceans &gt; Ocean Chemistry &gt; Ocean Tracers, Earth Science &gt; Oceans &gt; Marine Sediments, Earth Science &gt; Oceans &gt; Ocean Chemistry, Earth Science &gt; Oceans &gt; Sea Ice &gt; Isotopes, Earth Science &gt; Oceans &gt; Water Quality &gt; Ocean Contaminants, Earth Science &gt; Biological Classification &gt; Animals/Vertebrates &gt; Fish, Earth Science &gt; Biosphere &gt; Ecosystems &gt; Marine Ecosystems, Earth Science &gt; Biological Classification &gt; Animals/Invertebrates &gt; Mollusks, Earth Science &gt; Biological Classification &gt; Animals/Invertebrates &gt; Arthropods &gt; Crustaceans, Earth Science &gt; Biological Classification &gt; Plants &gt; Macroalgae (Seaweeds)\nkeywords_vocabulary: GCMD Science Keywords\nkeywords_vocabulary_url: https://gcmd.earthdata.nasa.gov/static/kms/\nrecord: \nfeatureType: \ncdm_data_type: \nConventions: CF-1.10 ACDD-1.3\npublisher_name: Paul MCGINNITY, Iolanda OSVATH, Florence DESCROIX-COMANDUCCI\npublisher_email: p.mc-ginnity@iaea.org, i.osvath@iaea.org, F.Descroix-Comanducci@iaea.org\npublisher_url: https://maris.iaea.org\npublisher_institution: International Atomic Energy Agency - IAEA\ncreator_name: [{"creatorType": "author", "firstName": "R T", "lastName": "Saito"}, {"creatorType": "author", "firstName": "I L", "lastName": "Cunha"}, {"creatorType": "author", "firstName": "R C L", "lastName": "Figueira"}, {"creatorType": "author", "firstName": "M G", "lastName": "Tessler"}]\ninstitution: \nmetadata_link: \ncreator_email: \ncreator_url: \nreferences: \nlicense: Without prejudice to the applicable Terms and Conditions (https://nucleus.iaea.org/Pages/Others/Disclaimer.aspx), I hereby agree that any use of the data will contain appropriate acknowledgement of the data source(s) and the IAEA Marine Radioactivity Information System (MARIS).\ncomment: \ngeospatial_lat_min: -47.41\ngeospatial_lon_min: -48.051944444444445\ngeospatial_lat_max: -24.68\ngeospatial_lon_max: -25.066111111111113\ngeospatial_vertical_min: \ngeospatial_vertical_max: \ngeospatial_bounds: POLYGON ((-48.051944444444445 -25.066111111111113, -47.41 -25.066111111111113, -47.41 -24.68, -48.051944444444445 -24.68, -48.051944444444445 -25.066111111111113))\ngeospatial_bounds_crs: EPSG:4326\ntime_coverage_start: 2003-01-01T00:00:00\ntime_coverage_end: 2003-01-01T00:00:00\nlocal_time_zone: \ndate_created: \ndate_modified: \npublisher_postprocess_logs: Remap to MARIS radionuclide names., Renaming variables to MARIS standard names., Drop variable containing only NaN or \'Not available\' (id=0 in MARIS lookup tables)., Assign Detection Limit name to its id based on MARIS nomenclature., Convert data from long to wide with renamed columns., Encode time as `int` representing seconds since xxx, Drop row when both longitude &amp; latitude equal 0.\n'</code></pre>
</div>
</div>
<div id="cell-14" class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>RAG.index(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    collection<span class="op">=</span>[dict_to_string(m[<span class="st">'value'</span>][<span class="st">'global_attributes'</span>]) <span class="cf">for</span> m <span class="kw">in</span> metadata_list][:<span class="dv">10</span>], </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    document_ids<span class="op">=</span>[m[<span class="st">'fname'</span>] <span class="cf">for</span> m <span class="kw">in</span> metadata_list][:<span class="dv">10</span>],</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    index_name<span class="op">=</span><span class="st">"MARIS NetCDFMetadata"</span>, </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    max_document_length<span class="op">=</span><span class="dv">180</span>, </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    split_documents<span class="op">=</span><span class="va">True</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>---- WARNING! You are using PLAID with an experimental replacement for FAISS for greater compatibility ----
This is a behaviour change from RAGatouille 0.8.0 onwards.
This works fine for most users and smallish datasets, but can be considerably slower than FAISS and could cause worse results in some situations.
If you're confident with FAISS working on your machine, pass use_faiss=True to revert to the FAISS-using behaviour.
--------------------


[Sep 16, 15:12:53] #&gt; Note: Output directory .ragatouille/colbert/indexes/MARIS NetCDFMetadata already exists


[Sep 16, 15:12:53] #&gt; Will delete 1 files already at .ragatouille/colbert/indexes/MARIS NetCDFMetadata in 20 seconds...
[Sep 16, 15:13:14] [0]       #&gt; Encoding 85 passages..</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|██████████| 3/3 [00:05&lt;00:00,  1.76s/it]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[Sep 16, 15:13:20] [0]       avg_doclen_est = 108.11764526367188     len(local_sample) = 85
[Sep 16, 15:13:20] [0]       Creating 1,024 partitions.
[Sep 16, 15:13:20] [0]       *Estimated* 9,189 embeddings.
[Sep 16, 15:13:20] [0]       #&gt; Saving the indexing plan to .ragatouille/colbert/indexes/MARIS NetCDFMetadata/plan.json ..</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Warning: number of training points (8731) is less than the minimum recommended (10240)
used 12 iterations (0.301s) to cluster 8731 items into 1024 clusters
[0.022, 0.024, 0.024, 0.023, 0.02, 0.023, 0.022, 0.022, 0.021, 0.023, 0.023, 0.02, 0.02, 0.024, 0.021, 0.023, 0.02, 0.022, 0.02, 0.023, 0.022, 0.024, 0.021, 0.021, 0.021, 0.02, 0.022, 0.022, 0.023, 0.025, 0.023, 0.025, 0.024, 0.02, 0.021, 0.022, 0.025, 0.024, 0.02, 0.024, 0.022, 0.023, 0.02, 0.025, 0.02, 0.022, 0.023, 0.024, 0.023, 0.023, 0.02, 0.023, 0.023, 0.023, 0.021, 0.023, 0.026, 0.024, 0.023, 0.022, 0.022, 0.023, 0.025, 0.024, 0.022, 0.024, 0.025, 0.021, 0.018, 0.023, 0.021, 0.021, 0.024, 0.024, 0.021, 0.024, 0.023, 0.026, 0.022, 0.023, 0.023, 0.023, 0.024, 0.023, 0.021, 0.023, 0.023, 0.023, 0.02, 0.027, 0.023, 0.023, 0.022, 0.023, 0.021, 0.024, 0.026, 0.022, 0.022, 0.02, 0.022, 0.028, 0.022, 0.022, 0.024, 0.021, 0.024, 0.02, 0.023, 0.02, 0.02, 0.025, 0.023, 0.019, 0.024, 0.021, 0.022, 0.022, 0.026, 0.022, 0.022, 0.022, 0.023, 0.025, 0.021, 0.023, 0.022, 0.02]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>0it [00:00, ?it/s]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[Sep 16, 15:13:20] [0]       #&gt; Encoding 85 passages..</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|██████████| 3/3 [00:04&lt;00:00,  1.49s/it]
1it [00:04,  4.52s/it]
100%|██████████| 1/1 [00:00&lt;00:00, 1558.06it/s]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[Sep 16, 15:13:24] #&gt; Optimizing IVF to store map from centroids to list of pids..
[Sep 16, 15:13:24] #&gt; Building the emb2pid mapping..
[Sep 16, 15:13:24] len(emb2pid) = 9190</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
100%|██████████| 1024/1024 [00:00&lt;00:00, 95246.87it/s]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[Sep 16, 15:13:24] #&gt; Saved optimized IVF to .ragatouille/colbert/indexes/MARIS NetCDFMetadata/ivf.pid.pt
Done indexing!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>'.ragatouille/colbert/indexes/MARIS NetCDFMetadata'</code></pre>
</div>
</div>
<div id="cell-15" class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>k <span class="op">=</span> <span class="dv">5</span> <span class="co"># How many documents you want to retrieve, defaults to 10, we set it to 3 here for readability</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> RAG.search(query<span class="op">=</span><span class="st">"What documents are about cs137 in biota?"</span>, k<span class="op">=</span>k)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Loading searcher for index MARIS NetCDFMetadata for the first time... This may take a few seconds
[Sep 16, 15:14:49] #&gt; Loading codec...
[Sep 16, 15:14:49] #&gt; Loading IVF...
[Sep 16, 15:14:49] Loading segmented_lookup_cpp extension (set COLBERT_LOAD_TORCH_EXTENSION_VERBOSE=True for more info)...
[Sep 16, 15:14:55] #&gt; Loading doclens...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|██████████| 1/1 [00:00&lt;00:00, 1918.71it/s]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[Sep 16, 15:14:55] #&gt; Loading codes and residuals...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
100%|██████████| 1/1 [00:00&lt;00:00, 274.51it/s]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[Sep 16, 15:14:55] Loading filter_pids_cpp extension (set COLBERT_LOAD_TORCH_EXTENSION_VERBOSE=True for more info)...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[Sep 16, 15:15:02] Loading decompress_residuals_cpp extension (set COLBERT_LOAD_TORCH_EXTENSION_VERBOSE=True for more info)...
Searcher loaded!

#&gt; QueryTokenizer.tensorize(batch_text[0], batch_background[0], bsize) ==
#&gt; Input: . What documents are about cs137 in biota?,        True,       None
#&gt; Output IDs: torch.Size([32]), tensor([  101,     1,  2054,  5491,  2024,  2055, 20116, 17134,  2581,  1999,
        16012,  2696,  1029,   102,   103,   103,   103,   103,   103,   103,
          103,   103,   103,   103,   103,   103,   103,   103,   103,   103,
          103,   103])
#&gt; Output Mask: torch.Size([32]), tensor([1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0])
</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>[{'content': 'Activity concentrations from 134+137Cs in organisms south of Fukushima were comparable to or lower than those from the naturally occurring 40K in the same samples. While 210Pb and 210Po concentrations were generally lower than these other radionuclides, 210Po as an α-emitter is more significant from a radiological viewpoint than γ-emitters as it can inflict greater biological damage. By applying known bioconcentration factors of Cs in biota, measured biota concentrations of Cs were also used to estimate Cs concentrations in coastal seawater to be in the range of 102-103 Bq m-3. These estimates show that, 3 months after the accident and maximal release of radioactive Cs, levels of Cs persisted in coastal waters, although at levels that were two orders of magnitude lower than at the time of release.',
  'score': 15.714044570922852,
  'rank': 1,
  'document_id': '520-Baumann-et-al-2013.nc',
  'passage_id': 76},
 {'content': 'id: \ntitle: Natural and Fukushima-derived radioactivity in macroalgae and mussels along the Japanese shoreline\nsummary: Following the failure of the nuclear power plant in Fukushima Prefecture in March 2011, peer-reviewed publications describing radioactivity levels in organisms inhabiting coastal environments are scarce. This paper reports on elevated levels of 134Cs and 137Cs in macroalgae and mussels (up to ~ 800 Bq kg-1 dry wt.) in June 2011. Cs concentrations in biota sampled in early June 2011 were higher in areas south of Fukushima than sampled in the last third of the month north of Fukushima. Activity concentrations from 134+137Cs in organisms south of Fukushima were comparable to or lower than those from the naturally occurring 40K in the same samples.',
  'score': 14.389057159423828,
  'rank': 2,
  'document_id': '520-Baumann-et-al-2013.nc',
  'passage_id': 75},
 {'content': 'Earth Science &gt; Biosphere &gt; Ecosystems &gt; Marine Ecosystems, Earth Science &gt; Biological Classification &gt; Animals/Invertebrates &gt; Mollusks, Earth Science &gt; Biological Classification &gt; Animals/Invertebrates &gt; Arthropods &gt; Crustaceans, Earth Science &gt; Biological Classification &gt; Plants &gt; Macroalgae (Seaweeds)\nkeywords_vocabulary: GCMD Science Keywords\nkeywords_vocabulary_url: https://gcmd.earthdata.nasa.gov/static/kms/\nrecord: \nfeatureType: \ncdm_data_type: \nConventions: CF-1.10 ACDD-1.3\npublisher_name: Paul MCGINNITY, Iolanda OSVATH, Florence DESCROIX-COMANDUCCI\npublisher_email: p.mc-ginnity@iaea.org, i.osvath@iaea.org,',
  'score': 10.734830856323242,
  'rank': 3,
  'document_id': '260-Diaz-Frances-et-al-2017.nc',
  'passage_id': 52},
 {'content': 'Earth Science &gt; Biological Classification &gt; Plants &gt; Macroalgae (Seaweeds)\nkeywords_vocabulary: GCMD Science Keywords\nkeywords_vocabulary_url: https://gcmd.earthdata.nasa.gov/static/kms/\nrecord: \nfeatureType: \ncdm_data_type: \nConventions: CF-1.10 ACDD-1.3\npublisher_name: Paul MCGINNITY, Iolanda OSVATH, Florence DESCROIX-COMANDUCCI\npublisher_email: p.mc-ginnity@iaea.org, i.osvath@iaea.org, F.Descroix-Comanducci@iaea.org\npublisher_url: https://maris.iaea.org\npublisher_institution: International Atomic Energy Agency - IAEA\ncreator_name: [{"creatorType": "author",',
  'score': 10.670204162597656,
  'rank': 4,
  'document_id': '265-Sathyapriya-et-al-2017.nc',
  'passage_id': 46},
 {'content': 'id: \ntitle: Fukushima 137Cs at the base of planktonic food webs off Japan\nsummary: The potential bioaccumulation of 137Cs in marine food webs off Japan became a concern following the release of radioactive contaminants from the damaged Fukushima nuclear power plant into the coastal ocean. Previous studies suggest that 137Cs activities increase with trophic level in pelagic food webs, however, the bioaccumulation of 137Cs from seawater to primary producers, to zooplankton has not been evaluated in the ﬁeld. Since phytoplankton are frequently the largest component of suspended particulate matter (SPM) we used SPM concentrations and particle-associated 137Cs to understand bioaccumulation of 137Cs in through trophic pathways in the ﬁeld.',
  'score': 10.626641273498535,
  'rank': 5,
  'document_id': '430-Baumann-et-al-2015.nc',
  'passage_id': 57}]</code></pre>
</div>
</div>
<div id="cell-16" class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>[{<span class="st">'lon_min'</span>: metadata[<span class="st">'value'</span>][<span class="st">'global_attributes'</span>][<span class="st">'geospatial_lon_min'</span>],</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">'lon_max'</span>: metadata[<span class="st">'value'</span>][<span class="st">'global_attributes'</span>][<span class="st">'geospatial_lon_max'</span>], </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">'lat_min'</span>: metadata[<span class="st">'value'</span>][<span class="st">'global_attributes'</span>][<span class="st">'geospatial_lat_min'</span>],</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">'lat_max'</span>: metadata[<span class="st">'value'</span>][<span class="st">'global_attributes'</span>][<span class="st">'geospatial_lat_max'</span>]} <span class="cf">for</span> metadata <span class="kw">in</span> metadata_list[:<span class="dv">10</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[{'lon_min': '-48.051944444444445',
  'lon_max': '-25.066111111111113',
  'lat_min': '-47.41',
  'lat_max': '-24.68'},
 {'lon_min': '-120.04',
  'lon_max': '30.0',
  'lat_min': '160.0',
  'lat_max': '47.0'},
 {'lon_min': '-90.38333333333334',
  'lon_max': '19.6024999999999',
  'lat_min': '-87.3541666699999',
  'lat_max': '20.75'},
 {'lon_min': '-117.5',
  'lon_max': '32.6',
  'lat_min': '-117.5',
  'lat_max': '32.6'},
 {'lon_min': '-8.600000000000001',
  'lon_max': '71.0',
  'lat_min': '34.0',
  'lat_max': '80.7'},
 {'lon_min': '74.85111111111111',
  'lon_max': '9.706944444444444',
  'lat_min': '74.85111111111111',
  'lat_max': '9.706944444444444'},
 {'lon_min': '-3.47',
  'lon_max': '36.24194444444444',
  'lat_min': '-3.47',
  'lat_max': '36.24194444444444'},
 {'lon_min': '141.4',
  'lon_max': '36.5',
  'lat_min': '143.0',
  'lat_max': '37.5'},
 {'lon_min': '-20.0',
  'lon_max': '39.0',
  'lat_min': '-14.0',
  'lat_max': '45.583333333333336'},
 {'lon_min': '140.91',
  'lon_max': '36.94',
  'lat_min': '141.07',
  'lat_max': '38.29'}]</code></pre>
</div>
</div>
<div id="cell-17" class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>[m[<span class="st">'value'</span>] <span class="cf">for</span> m <span class="kw">in</span> metadata_list <span class="cf">if</span> m[<span class="st">'fname'</span>] <span class="op">==</span> <span class="st">'158-Buesseler-2018.nc'</span>][:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[{'global_attributes': {'id': '',
   'title': 'Ken Buesseler, unpub.',
   'summary': '',
   'keywords': 'oceanography, Earth Science &gt; Oceans &gt; Ocean Chemistry&gt; Radionuclides, Earth Science &gt; Human Dimensions &gt; Environmental Impacts &gt; Nuclear Radiation Exposure, Earth Science &gt; Oceans &gt; Ocean Chemistry &gt; Ocean Tracers, Earth Science &gt; Oceans &gt; Marine Sediments, Earth Science &gt; Oceans &gt; Ocean Chemistry, Earth Science &gt; Oceans &gt; Sea Ice &gt; Isotopes, Earth Science &gt; Oceans &gt; Water Quality &gt; Ocean Contaminants, Earth Science &gt; Biological Classification &gt; Animals/Vertebrates &gt; Fish, Earth Science &gt; Biosphere &gt; Ecosystems &gt; Marine Ecosystems, Earth Science &gt; Biological Classification &gt; Animals/Invertebrates &gt; Mollusks, Earth Science &gt; Biological Classification &gt; Animals/Invertebrates &gt; Arthropods &gt; Crustaceans, Earth Science &gt; Biological Classification &gt; Plants &gt; Macroalgae (Seaweeds)',
   'keywords_vocabulary': 'GCMD Science Keywords',
   'keywords_vocabulary_url': 'https://gcmd.earthdata.nasa.gov/static/kms/',
   'record': '',
   'featureType': '',
   'cdm_data_type': '',
   'Conventions': 'CF-1.10 ACDD-1.3',
   'publisher_name': 'Paul MCGINNITY, Iolanda OSVATH, Florence DESCROIX-COMANDUCCI',
   'publisher_email': 'p.mc-ginnity@iaea.org, i.osvath@iaea.org, F.Descroix-Comanducci@iaea.org',
   'publisher_url': 'https://maris.iaea.org',
   'publisher_institution': 'International Atomic Energy Agency - IAEA',
   'creator_name': '[{"creatorType": "author", "firstName": "Ken", "lastName": "Buesseler"}]',
   'institution': '',
   'metadata_link': '',
   'creator_email': '',
   'creator_url': '',
   'references': '',
   'license': 'Without prejudice to the applicable Terms and Conditions (https://nucleus.iaea.org/Pages/Others/Disclaimer.aspx), I hereby agree that any use of the data will contain appropriate acknowledgement of the data source(s) and the IAEA Marine Radioactivity Information System (MARIS).',
   'comment': '',
   'geospatial_lat_min': '160.0',
   'geospatial_lon_min': '-120.04',
   'geospatial_lat_max': '47.0',
   'geospatial_lon_max': '30.0',
   'geospatial_vertical_min': '-1279.0',
   'geospatial_vertical_max': '-1.0',
   'geospatial_bounds': 'POLYGON ((-120.04 30, 160 30, 160 47, -120.04 47, -120.04 30))',
   'geospatial_bounds_crs': 'EPSG:4326',
   'time_coverage_start': '2011-03-22T00:00:00',
   'time_coverage_end': '2014-10-22T00:00:00',
   'local_time_zone': '',
   'date_created': '',
   'date_modified': '',
   'publisher_postprocess_logs': "Remap to MARIS radionuclide names., Renaming variables to MARIS standard names., Drop variable containing only NaN or 'Not available' (id=0 in MARIS lookup tables)., Assign Detection Limit name to its id based on MARIS nomenclature., Convert data from long to wide with renamed columns., Encode time as `int` representing seconds since xxx, Drop row when both longitude &amp; latitude equal 0."}}]</code></pre>
</div>
</div>
<div id="cell-18" class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>k <span class="op">=</span> <span class="dv">5</span> <span class="co">#  How many documents you want to retrieve, defaults to 10, we set it to 3 here for readability</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> RAG.search(query<span class="op">=</span><span class="st">"What documents includ data at coordinates: (lon, lat) = (-30, -30) ?"</span>, k<span class="op">=</span>k)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[{'content': 'I hereby agree that any use of the data will contain appropriate acknowledgement of the data source(s) and the IAEA Marine Radioactivity Information System (MARIS).\ncomment: \ngeospatial_lat_min: 160.0\ngeospatial_lon_min: -120.04\ngeospatial_lat_max: 47.0\ngeospatial_lon_max: 30.0\ngeospatial_vertical_min: -1279.0\ngeospatial_vertical_max: -1.0\ngeospatial_bounds: POLYGON ((-120.04 30, 160 30, 160 47, -120.04 47, -120.',
  'score': 14.827706336975098,
  'rank': 1,
  'document_id': '158-Buesseler-2018.nc',
  'passage_id': 12},
 {'content': 'I hereby agree that any use of the data will contain appropriate acknowledgement of the data source(s) and the IAEA Marine Radioactivity Information System (MARIS).\ncomment: \ngeospatial_lat_min: 34.0\ngeospatial_lon_min: -8.600000000000001\ngeospatial_lat_max: 80.7\ngeospatial_lon_max: 71.0\ngeospatial_vertical_min: \ngeospatial_vertical_max: \ngeospatial_bounds: POLYGON ((-8.600000000000001 71, 34 71, 34 80.7, -8.600000000000001 80.7, -8.',
  'score': 13.72603702545166,
  'rank': 2,
  'document_id': '481-Andersen-et-al-2006.nc',
  'passage_id': 40},
 {'content': '0\ngeospatial_lon_min: -20.0\ngeospatial_lat_max: 45.583333333333336\ngeospatial_lon_max: 39.0\ngeospatial_vertical_min: \ngeospatial_vertical_max: \ngeospatial_bounds: POLYGON ((-20 39, -14 39, -14 45.583333333333336, -20 45.583333333333336, -20 39))\ngeospatial_bounds_crs: EPSG:4326\ntime_coverage_start: 1984-04-15T00:00:00\ntime_coverage_end: 1985-05-01T00:00:00\nlocal_time_zone: \ndate_created: \ndate_modified: \npublisher_postprocess_logs: Remap to MARIS radionuclide names.',
  'score': 13.647236824035645,
  'rank': 3,
  'document_id': '448-HEYRAUD-et-al-1988.nc',
  'passage_id': 73},
 {'content': 'I hereby agree that any use of the data will contain appropriate acknowledgement of the data source(s) and the IAEA Marine Radioactivity Information System (MARIS).\ncomment: \ngeospatial_lat_min: -87.3541666699999\ngeospatial_lon_min: -90.38333333333334\ngeospatial_lat_max: 20.75\ngeospatial_lon_max: 19.6024999999999\ngeospatial_vertical_min: \ngeospatial_vertical_max: \ngeospatial_bounds: POLYGON ((-90.38333333333334 19.6024999999999, -87.3541666699999 19.6024999999999, -87.3541666699999 20.75, -90.38333333333334 20.75, -90.',
  'score': 13.479910850524902,
  'rank': 4,
  'document_id': '187-Carnero-Bravo-et-al-2018.nc',
  'passage_id': 23},
 {'content': 'comment: \ngeospatial_lat_min: 143.0\ngeospatial_lon_min: 141.4\ngeospatial_lat_max: 37.5\ngeospatial_lon_max: 36.5\ngeospatial_vertical_min: \ngeospatial_vertical_max: \ngeospatial_bounds: POLYGON ((141.4 36.5, 143 36.5, 143 37.5, 141.4 37.5, 141.4 36.',
  'score': 12.810436248779297,
  'rank': 5,
  'document_id': '430-Baumann-et-al-2015.nc',
  'passage_id': 64}]</code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/franckalbinet\.github\.io\/marise");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/franckalbinet/marise/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>